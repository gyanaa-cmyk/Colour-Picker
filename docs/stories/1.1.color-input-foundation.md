# Story 1.1: Color Input Foundation

## Status
Done

## Story
**As a** UI designer or developer using ColorSmith,
**I want** to input colors through multiple formats (HEX, RGB, HSL) and use an eyedropper tool,
**so that** I can easily specify my starting color regardless of my preferred format or need to sample from existing designs.

## Acceptance Criteria
1. User can input colors in HEX format (#abc, #aabbcc)
2. User can input colors in RGB format (rgb(255,0,0) or 255,0,0)
3. User can input colors in HSL format (hsl(360,100%,50%) or 360,100,50)
4. Input validation shows clear error messages for invalid formats
5. EyeDropper tool is available using native browser API
6. Fallback upload + canvas picker is available when EyeDropper API unsupported
7. Color preview updates immediately upon valid input
8. All input methods populate the same color state for downstream processing

## Tasks / Subtasks
- [x] Task 1: Set up ColorInput component structure (AC: 1,2,3,7)
  - [x] Create `src/components/inputs/ColorInput.tsx` component file
  - [x] Set up component props and TypeScript interfaces
  - [x] Create input fields for HEX, RGB, HSL formats
  - [x] Implement live preview swatch display
- [x] Task 2: Implement color parsing and validation (AC: 1,2,3,4)
  - [x] Create `src/engine/color-space.ts` parsing functions using culori library
  - [x] Implement `parseColor(input: string): Color` function
  - [x] Implement `toAllSpaces(hexOrColor: string|Color): Color` function
  - [x] Add validation logic with specific error messages per format
  - [x] Connect validation to UI error display
- [x] Task 3: Implement EyeDropper functionality (AC: 5,6)
  - [x] Create `src/utils/eyedropper.ts` utility module
  - [x] Implement native EyeDropper API integration
  - [x] Create fallback upload + canvas picker component
  - [x] Add feature detection and graceful fallback
- [x] Task 4: Integrate with Zustand state management (AC: 7,8)
  - [x] Connect ColorInput to `useSeedSlice` state store
  - [x] Ensure all input methods update the same Color state
  - [x] Implement immediate preview updates on state change
- [x] Task 5: Add comprehensive testing (Testing Standards)
  - [x] Create unit tests for color parsing functions
  - [x] Create component tests for ColorInput interactions
  - [x] Add tests for validation error scenarios
  - [x] Test EyeDropper feature detection and fallback

## Dev Notes

### Previous Story Insights
No previous story - this is the foundation story for the ColorSmith application.

### Data Models
**Color Type Definition** [Source: architecture/5-type-models.md#color-representations]:
```ts
export type RGB = [number, number, number];
export type HSL = [number, number, number];
export type OKLCH = [number, number, number]; // l(0..1), c(0..~0.4), h(0..360)

export type Color = {
  hex: string;
  rgb: RGB;
  hsl: HSL;
  oklch: OKLCH;
  name?: string;
};
```

### API Specifications
**Color Engine API** [Source: architecture/6-color-engine-design.md#key-apis]:
```ts
export function parseColor(input: string): Color; // #abc, #aabbcc, rgb(), hsl()
export function toAllSpaces(hexOrColor: string|Color): Color; // populate rgb/hsl/oklch
```

### Component Specifications
**ColorInput Component** [Source: architecture/8-ui-component-architecture.md]:
- Text fields for HEX/RGB/HSL input
- EyeDropper button integration
- Validation messages display
- All components read/write only their slice via selectors → no prop drilling
- Copy actions emit `uiSlice.toast({type:'success', message:'Copied HEX'})`

### File Locations
**Project Structure** [Source: architecture/4-filefolder-structure-proposed.md]:
- Main component: `src/components/inputs/ColorInput.tsx`
- Color engine: `src/engine/color-space.ts`
- Utilities: `src/utils/eyedropper.ts`
- State management: `src/state/useSeedSlice.ts`
- Tests: `src/tests/unit/engine/color-space.test.ts`

### Technical Constraints
**Tech Stack** [Source: architecture/2-tech-stack-libraries.md]:
- Framework: React 18 + Vite + TypeScript
- Styling: Tailwind CSS, Radix UI primitives
- Color Engine: `culori` for OKLCH/OKLab/OKHSV/HSL conversion
- State: Zustand slices per domain
- Testing: Vitest + React Testing Library

**Error Handling** [Source: architecture/12-error-handling-edge-cases.md]:
- Invalid color input → inline error, disable generate
- EyeDropper unsupported → show upload‑image picker fallback

### Testing
**Testing Standards** [Source: architecture/13-testing-strategy.md]:
- **Unit Tests**: Color conversions, scheme outputs, validation logic
- **Component Tests**: Palette grid behavior, copy/export, keyboard navigation  
- **Test Location**: `src/tests/unit/engine/*.test.ts` for engine tests
- **Testing Framework**: Vitest + React Testing Library
- **Focus Areas**: Color parsing accuracy, validation error handling, EyeDropper fallback behavior

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Initial story creation | Scrum Master |
| 2025-10-04 | 1.1 | Story validated and approved for implementation | Product Owner |
| 2025-10-04 | 1.2 | Implemented; tests passing; moved to Ready for Review | Dev Agent |
| 2025-10-04 | 1.3 | QA PASS gate; story marked Done | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
James (dev)

### Debug Log References
- Build: npm run build → success
- Tests: vitest run → 2 suites, 6 tests passing (component tests emit React act warnings; non-blocking)
- Lint: eslint . → 0 errors

### Completion Notes List
- Implemented ColorInput with HEX/RGB/HSL inputs, preview swatch, and validation messaging
- Added culori-based color engine util (parseColor, toAllSpaces) with unit tests
- Integrated Zustand seed slice; all input paths update the same state and trigger preview
- Implemented native EyeDropper support with Canvas image picker fallback
- Added component tests for preview update and fallback text; engine tests for formats and invalid input
- Configured Vitest with jest-dom matchers; excluded tests from TypeScript build
- Verified build output and ensured no lint errors

### File List
- frontend/colorsmith-app/src/state/useSeedSlice.ts (added)
- frontend/colorsmith-app/src/engine/color-space.ts (added)
- frontend/colorsmith-app/src/utils/eyedropper.ts (added)
- frontend/colorsmith-app/src/components/inputs/ColorInput.tsx (added)
- frontend/colorsmith-app/src/components/inputs/CanvasPicker.tsx (added)
- frontend/colorsmith-app/src/App.tsx (modified)
- frontend/colorsmith-app/src/tests/unit/engine/color-space.test.ts (added)
- frontend/colorsmith-app/src/tests/unit/components/color-input.test.tsx (added)
- frontend/colorsmith-app/vitest.setup.ts (added)
- frontend/colorsmith-app/vitest.config.ts (added)
- frontend/colorsmith-app/tsconfig.app.json (modified)
- frontend/colorsmith-app/package.json (modified)

## QA Results
Decision: PASS (2025-10-04) — Reviewer: QA Agent (Quinn)

Summary:
- Functional coverage: HEX/RGB/HSL input, validation messaging, EyeDropper + image picker fallback, live preview — all verified
- Tests: Engine unit tests and component tests passing; build and lint clean
- Notes: Non-blocking React act() warnings in component tests (recommend wrapping interactions with act or RTL async utilities)

Gate File: docs/qa/gates/1.1-color-input-foundation.yml