# Story 1.1: Color Input Foundation

## Status
Approved

## Story
**As a** UI designer or developer using ColorSmith,
**I want** to input colors through multiple formats (HEX, RGB, HSL) and use an eyedropper tool,
**so that** I can easily specify my starting color regardless of my preferred format or need to sample from existing designs.

## Acceptance Criteria
1. User can input colors in HEX format (#abc, #aabbcc)
2. User can input colors in RGB format (rgb(255,0,0) or 255,0,0)
3. User can input colors in HSL format (hsl(360,100%,50%) or 360,100,50)
4. Input validation shows clear error messages for invalid formats
5. EyeDropper tool is available using native browser API
6. Fallback upload + canvas picker is available when EyeDropper API unsupported
7. Color preview updates immediately upon valid input
8. All input methods populate the same color state for downstream processing

## Tasks / Subtasks
- [ ] Task 1: Set up ColorInput component structure (AC: 1,2,3,7)
  - [ ] Create `src/components/inputs/ColorInput.tsx` component file
  - [ ] Set up component props and TypeScript interfaces
  - [ ] Create input fields for HEX, RGB, HSL formats
  - [ ] Implement live preview swatch display
- [ ] Task 2: Implement color parsing and validation (AC: 1,2,3,4)
  - [ ] Create `src/engine/color-space.ts` parsing functions using culori library
  - [ ] Implement `parseColor(input: string): Color` function
  - [ ] Implement `toAllSpaces(hexOrColor: string|Color): Color` function
  - [ ] Add validation logic with specific error messages per format
  - [ ] Connect validation to UI error display
- [ ] Task 3: Implement EyeDropper functionality (AC: 5,6)
  - [ ] Create `src/utils/eyedropper.ts` utility module
  - [ ] Implement native EyeDropper API integration
  - [ ] Create fallback upload + canvas picker component
  - [ ] Add feature detection and graceful fallback
- [ ] Task 4: Integrate with Zustand state management (AC: 7,8)
  - [ ] Connect ColorInput to `useSeedSlice` state store
  - [ ] Ensure all input methods update the same Color state
  - [ ] Implement immediate preview updates on state change
- [ ] Task 5: Add comprehensive testing (Testing Standards)
  - [ ] Create unit tests for color parsing functions
  - [ ] Create component tests for ColorInput interactions
  - [ ] Add tests for validation error scenarios
  - [ ] Test EyeDropper feature detection and fallback

## Dev Notes

### Previous Story Insights
No previous story - this is the foundation story for the ColorSmith application.

### Data Models
**Color Type Definition** [Source: architecture/5-type-models.md#color-representations]:
```ts
export type RGB = [number, number, number];
export type HSL = [number, number, number];
export type OKLCH = [number, number, number]; // l(0..1), c(0..~0.4), h(0..360)

export type Color = {
  hex: string;
  rgb: RGB;
  hsl: HSL;
  oklch: OKLCH;
  name?: string;
};
```

### API Specifications
**Color Engine API** [Source: architecture/6-color-engine-design.md#key-apis]:
```ts
export function parseColor(input: string): Color; // #abc, #aabbcc, rgb(), hsl()
export function toAllSpaces(hexOrColor: string|Color): Color; // populate rgb/hsl/oklch
```

### Component Specifications
**ColorInput Component** [Source: architecture/8-ui-component-architecture.md]:
- Text fields for HEX/RGB/HSL input
- EyeDropper button integration
- Validation messages display
- All components read/write only their slice via selectors → no prop drilling
- Copy actions emit `uiSlice.toast({type:'success', message:'Copied HEX'})`

### File Locations
**Project Structure** [Source: architecture/4-filefolder-structure-proposed.md]:
- Main component: `src/components/inputs/ColorInput.tsx`
- Color engine: `src/engine/color-space.ts`
- Utilities: `src/utils/eyedropper.ts`
- State management: `src/state/useSeedSlice.ts`
- Tests: `src/tests/unit/engine/color-space.test.ts`

### Technical Constraints
**Tech Stack** [Source: architecture/2-tech-stack-libraries.md]:
- Framework: React 18 + Vite + TypeScript
- Styling: Tailwind CSS, Radix UI primitives
- Color Engine: `culori` for OKLCH/OKLab/OKHSV/HSL conversion
- State: Zustand slices per domain
- Testing: Vitest + React Testing Library

**Error Handling** [Source: architecture/12-error-handling-edge-cases.md]:
- Invalid color input → inline error, disable generate
- EyeDropper unsupported → show upload‑image picker fallback

### Testing
**Testing Standards** [Source: architecture/13-testing-strategy.md]:
- **Unit Tests**: Color conversions, scheme outputs, validation logic
- **Component Tests**: Palette grid behavior, copy/export, keyboard navigation  
- **Test Location**: `src/tests/unit/engine/*.test.ts` for engine tests
- **Testing Framework**: Vitest + React Testing Library
- **Focus Areas**: Color parsing accuracy, validation error handling, EyeDropper fallback behavior

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Initial story creation | Scrum Master |
| 2025-10-04 | 1.1 | Story validated and approved for implementation | Product Owner |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*